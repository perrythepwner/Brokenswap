{"ast":null,"code":"import _taggedTemplateLiteral from\"/home/simone/Scrivania/progetti/HTB_challs/HackTheBoo_23/VeryEasy2/Brokenswap/frontend/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject;import{ChainId}from'@celo/react-celo';import{cUSD}from'@ubeswap/sdk';import{useOnClickOutside}from'hooks/useOnClickOutside';import useTheme from'hooks/useTheme';import useToggle from'hooks/useToggle';import React,{useCallback,useEffect,useMemo,useRef,useState}from'react';import AutoSizer from'react-virtualized-auto-sizer';import{Text}from'rebass';import styled from'styled-components';import{useAllTokens,useFoundOnInactiveList,useIsUserAddedToken,useToken}from'../../hooks/Tokens';import{CloseIcon,TYPE}from'../../theme';import{isAddress}from'../../utils';import{ButtonLight}from'../Button';import Column from'../Column';import Row,{RowBetween}from'../Row';import CommonBases from'./CommonBases';import CurrencyList from'./CurrencyList';import{filterTokens}from'./filtering';import ImportRow from'./ImportRow';import{useTokenComparator}from'./sorting';import{PaddedColumn,SearchInput,Separator}from'./styleds';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const ContentWrapper=styled(Column)(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  width: 100%;\\n  flex: 1 1;\\n  position: relative;\\n\"])));export function CurrencySearch(_ref){let{selectedCurrency,onCurrencySelect,otherSelectedCurrency,showCommonBases,onDismiss,isOpen,showImportView,setImportToken,chainId=ChainId.Mainnet}=_ref;const theme=useTheme();// refs for fixed size lists\nconst fixedList=useRef();const[searchQuery,setSearchQuery]=useState('');const[invertSearchOrder]=useState(false);const allTokens=useAllTokens();// if they input an address, use it\nconst searchToken=useToken(searchQuery);const searchTokenIsAdded=useIsUserAddedToken(searchToken);const showETH=useMemo(()=>{const s=searchQuery.toLowerCase().trim();return s===''||s==='e'||s==='et'||s==='eth';},[searchQuery]);const tokenComparator=useTokenComparator(invertSearchOrder);const filteredTokens=useMemo(()=>{return filterTokens(Object.values(allTokens),searchQuery);},[allTokens,searchQuery]);const filteredSortedTokens=useMemo(()=>{const sorted=filteredTokens.sort(tokenComparator);const symbolMatch=searchQuery.toLowerCase().split(/\\s+/).filter(s=>s.length>0);if(symbolMatch.length>1){return sorted;}return[// sort any exact symbol matches first\n...sorted.filter(token=>{var _token$symbol;return((_token$symbol=token.symbol)===null||_token$symbol===void 0?void 0:_token$symbol.toLowerCase())===symbolMatch[0];}),// sort by tokens whos symbols start with search substrng\n...sorted.filter(token=>{var _token$symbol2,_token$symbol3;return((_token$symbol2=token.symbol)===null||_token$symbol2===void 0?void 0:_token$symbol2.toLowerCase().startsWith(searchQuery.toLowerCase().trim()))&&((_token$symbol3=token.symbol)===null||_token$symbol3===void 0?void 0:_token$symbol3.toLowerCase())!==symbolMatch[0];}),// rest that dont match upove\n...sorted.filter(token=>{var _token$symbol4,_token$symbol5;return!((_token$symbol4=token.symbol)!==null&&_token$symbol4!==void 0&&_token$symbol4.toLowerCase().startsWith(searchQuery.toLowerCase().trim()))&&((_token$symbol5=token.symbol)===null||_token$symbol5===void 0?void 0:_token$symbol5.toLowerCase())!==symbolMatch[0];})];},[filteredTokens,searchQuery,tokenComparator]);const handleCurrencySelect=useCallback(currency=>{onCurrencySelect(currency);onDismiss();},[onDismiss,onCurrencySelect]);// clear the input on open\nuseEffect(()=>{if(isOpen)setSearchQuery('');},[isOpen]);// manage focus on modal show\nconst inputRef=useRef();const handleInput=useCallback(event=>{var _fixedList$current;const input=event.target.value;const checksummedInput=isAddress(input);setSearchQuery(checksummedInput||input);(_fixedList$current=fixedList.current)===null||_fixedList$current===void 0?void 0:_fixedList$current.scrollTo(0);},[]);const handleEnter=useCallback(e=>{if(e.key==='Enter'){const s=searchQuery.toLowerCase().trim();if(s==='cusd'){handleCurrencySelect(cUSD[chainId]);}else if(filteredSortedTokens.length>0){var _filteredSortedTokens;if(((_filteredSortedTokens=filteredSortedTokens[0].symbol)===null||_filteredSortedTokens===void 0?void 0:_filteredSortedTokens.toLowerCase())===searchQuery.trim().toLowerCase()||filteredSortedTokens.length===1){handleCurrencySelect(filteredSortedTokens[0]);}}}},[filteredSortedTokens,handleCurrencySelect,searchQuery,chainId]);// menu ui\nconst[open,toggle]=useToggle(false);const node=useRef();useOnClickOutside(node,open?toggle:undefined);// if no results on main list, show option to expand into inactive\nconst[showExpanded,setShowExpanded]=useState(false);const inactiveTokens=useFoundOnInactiveList(searchQuery);// reset expanded results on query reset\nuseEffect(()=>{if(searchQuery===''){setShowExpanded(false);}},[setShowExpanded,searchQuery]);return/*#__PURE__*/_jsxs(ContentWrapper,{children:[/*#__PURE__*/_jsxs(PaddedColumn,{gap:\"16px\",children:[/*#__PURE__*/_jsxs(RowBetween,{children:[/*#__PURE__*/_jsx(Text,{fontWeight:500,fontSize:16,children:'Select a token'}),/*#__PURE__*/_jsx(CloseIcon,{onClick:onDismiss})]}),/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(SearchInput,{type:\"text\",id:\"token-search-input\",placeholder:'Search name or paste address',autoComplete:\"off\",value:searchQuery,ref:inputRef,onChange:handleInput,onKeyDown:handleEnter})}),showCommonBases&&/*#__PURE__*/_jsx(CommonBases,{onSelect:handleCurrencySelect,selectedCurrency:selectedCurrency})]}),/*#__PURE__*/_jsx(Separator,{}),searchToken&&!searchTokenIsAdded?/*#__PURE__*/_jsx(Column,{style:{padding:'20px 0',height:'100%'},children:/*#__PURE__*/_jsx(ImportRow,{token:searchToken,showImportView:showImportView,setImportToken:setImportToken})}):(filteredSortedTokens===null||filteredSortedTokens===void 0?void 0:filteredSortedTokens.length)>0||showExpanded&&inactiveTokens&&inactiveTokens.length>0?/*#__PURE__*/_jsx(\"div\",{style:{flex:'1'},children:/*#__PURE__*/_jsx(AutoSizer,{disableWidth:true,children:_ref2=>{let{height}=_ref2;return/*#__PURE__*/_jsx(CurrencyList,{height:height,showETH:showETH,currencies:showExpanded&&inactiveTokens?filteredSortedTokens.concat(inactiveTokens):filteredSortedTokens,onCurrencySelect:handleCurrencySelect,otherCurrency:otherSelectedCurrency,selectedCurrency:selectedCurrency,fixedListRef:fixedList,showImportView:showImportView,setImportToken:setImportToken});}})}):/*#__PURE__*/_jsxs(Column,{style:{padding:'20px',height:'100%'},children:[/*#__PURE__*/_jsxs(TYPE.main,{color:theme.text3,textAlign:\"center\",mb:\"20px\",children:['No results found in active lists',\".\"]}),inactiveTokens&&inactiveTokens.length>0&&!(searchToken&&!searchTokenIsAdded)&&searchQuery.length>1&&(filteredSortedTokens===null||filteredSortedTokens===void 0?void 0:filteredSortedTokens.length)===0&&/*#__PURE__*/ // expand button in line with no results\n_jsx(Row,{align:\"center\",width:\"100%\",justify:\"center\",children:/*#__PURE__*/_jsx(ButtonLight,{width:\"fit-content\",borderRadius:\"12px\",padding:\"8px 12px\",onClick:()=>setShowExpanded(!showExpanded),children:!showExpanded?'Show'.concat(\" \",inactiveTokens.length,\" \",'more inactive',\" \").concat(inactiveTokens.length===1?'Token':'Tokens'):'Hide expanded search'})})]}),inactiveTokens&&inactiveTokens.length>0&&!(searchToken&&!searchTokenIsAdded)&&(searchQuery.length>1||showExpanded)&&((filteredSortedTokens===null||filteredSortedTokens===void 0?void 0:filteredSortedTokens.length)!==0||showExpanded)&&/*#__PURE__*/ // button fixed to bottom\n_jsx(Row,{align:\"center\",width:\"100%\",justify:\"center\",style:{position:'absolute',bottom:'80px',left:0},children:/*#__PURE__*/_jsx(ButtonLight,{width:\"fit-content\",borderRadius:\"12px\",padding:\"8px 12px\",onClick:()=>setShowExpanded(!showExpanded),children:!showExpanded?'Show'.concat(\" \",inactiveTokens.length,\" \",'more inactive',\" \").concat(inactiveTokens.length===1?'Token':'Tokens'):'Hide expanded search'})})]});}","map":null,"metadata":{},"sourceType":"module"}