{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ListCompositeTreeViewDU = void 0;\nconst persistent_merkle_tree_1 = require(\"@chainsafe/persistent-merkle-tree\");\nconst arrayComposite_1 = require(\"./arrayComposite\");\nclass ListCompositeTreeViewDU extends arrayComposite_1.ArrayCompositeTreeViewDU {\n  constructor(type, _rootNode, cache) {\n    super(type, _rootNode, cache);\n    this.type = type;\n    this._rootNode = _rootNode;\n  }\n  /**\n   * Adds one value element at the end of the array and adds 1 to the un-commited ViewDU length\n   */\n  push(view) {\n    if (this._length >= this.type.limit) {\n      throw Error(\"Error pushing over limit\");\n    }\n    this.dirtyLength = true;\n    const index = this._length++;\n    // No need for pre-initialization like in ListBasic.push since ArrayCompositeTreeViewDU.set() doesn't do a get node\n    this.set(index, view);\n  }\n  /**\n   * Returns a new ListCompositeTreeViewDU instance with the values from 0 to `index`.\n   * The new list is equivalent to (pseudo-code):\n   *\n   * ```ts\n   * const nodes = getChunkNodes()\n   * return listFromChunkNodes(nodes.slice(0, index + 1))\n   * ```\n   *\n   * To achieve it, rebinds the underlying tree zero-ing all nodes right of `index`.\n   *\n   * Note: Using index = -1, returns an empty list of length 0.\n   */\n  sliceTo(index) {\n    // Commit before getting rootNode to ensure all pending data is in the rootNode\n    this.commit();\n    const rootNode = this._rootNode;\n    const length = this.type.tree_getLength(rootNode);\n    // All nodes beyond length are already zero\n    // Array of length 2: [X,X,0,0], for index >= 1 no action needed\n    if (index >= length - 1) {\n      return this;\n    }\n    // Since this is a List, do the treeZeroAfterIndex operation on the chunks tree\n    const chunksNode = this.type.tree_getChunksNode(rootNode);\n    const newChunksNode = persistent_merkle_tree_1.treeZeroAfterIndex(chunksNode, this.type.chunkDepth, index);\n    // Must set new length and commit to tree to restore the same tree at that index\n    const newLength = index + 1;\n    const newRootNode = this.type.tree_setChunksNode(rootNode, newChunksNode, newLength);\n    return this.type.getViewDU(newRootNode);\n  }\n}\nexports.ListCompositeTreeViewDU = ListCompositeTreeViewDU;","map":null,"metadata":{},"sourceType":"script"}