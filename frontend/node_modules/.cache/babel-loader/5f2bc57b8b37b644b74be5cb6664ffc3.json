{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function get() {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n      label: 0,\n      sent: function sent() {\n        if (t[0] & 1) throw t[1];\n        return t[1];\n      },\n      trys: [],\n      ops: []\n    },\n    f,\n    y,\n    t,\n    g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n        case 7:\n          op = _.ops.pop();\n          _.trys.pop();\n          continue;\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n            _.ops.push(op);\n            break;\n          }\n          if (t[2]) _.ops.pop();\n          _.trys.pop();\n          continue;\n      }\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.IdentityMetadataWrapper = exports.IdentityMetadataType = exports.ClaimTypes = void 0;\nvar address_1 = require(\"@celo/base/lib/address\");\nvar async_1 = require(\"@celo/base/lib/async\");\nvar io_1 = require(\"@celo/utils/lib/io\");\nvar signatureUtils_1 = require(\"@celo/utils/lib/signatureUtils\");\nvar cross_fetch_1 = __importDefault(require(\"cross-fetch\"));\nvar Either_1 = require(\"fp-ts/lib/Either\");\nvar t = __importStar(require(\"io-ts\"));\nvar PathReporter_1 = require(\"io-ts/lib/PathReporter\");\nvar Accounts_1 = require(\"../wrappers/Accounts\");\nvar claim_1 = require(\"./claims/claim\");\nvar types_1 = require(\"./claims/types\");\nvar types_2 = require(\"./claims/types\");\nObject.defineProperty(exports, \"ClaimTypes\", {\n  enumerable: true,\n  get: function get() {\n    return types_2.ClaimTypes;\n  }\n});\nvar MetaType = t.type({\n  address: io_1.AddressType,\n  signature: io_1.SignatureType\n});\nexports.IdentityMetadataType = t.type({\n  claims: t.array(claim_1.ClaimType),\n  meta: MetaType\n});\nvar IdentityMetadataWrapper = /** @class */function () {\n  function IdentityMetadataWrapper(data) {\n    this.data = data;\n  }\n  IdentityMetadataWrapper.fromEmpty = function (address) {\n    return new IdentityMetadataWrapper({\n      claims: [],\n      meta: {\n        address: address,\n        signature: ''\n      }\n    });\n  };\n  IdentityMetadataWrapper.fetchFromURL = function (contractKitOrAccountsWrapper, url, tries) {\n    if (tries === void 0) {\n      tries = 3;\n    }\n    return __awaiter(this, void 0, void 0, function () {\n      var _this = this;\n      return __generator(this, function (_a) {\n        return [2 /*return*/, (0, async_1.selectiveRetryAsyncWithBackOff)(function () {\n          return __awaiter(_this, void 0, void 0, function () {\n            var resp, _a, _b;\n            return __generator(this, function (_c) {\n              switch (_c.label) {\n                case 0:\n                  return [4 /*yield*/, (0, cross_fetch_1.default)(url)];\n                case 1:\n                  resp = _c.sent();\n                  if (!resp.ok) {\n                    throw new Error(\"Request failed with status \".concat(resp.status));\n                  }\n                  _a = this.fromRawString;\n                  _b = [contractKitOrAccountsWrapper];\n                  return [4 /*yield*/, resp.text()];\n                case 2:\n                  return [2 /*return*/, _a.apply(this, _b.concat([_c.sent()]))];\n              }\n            });\n          });\n        }, tries, ['Request failed with status 404'], [])];\n      });\n    });\n  };\n  IdentityMetadataWrapper.fromFile = function (contractKitOrAccountsWrapper, path) {\n    var readFileSync;\n    try {\n      var fs = require('fs');\n      readFileSync = fs.readFileSync;\n    } catch (_a) {\n      console.error('cant read from file in browser or environment without native fs module');\n    }\n    return this.fromRawString(contractKitOrAccountsWrapper, readFileSync(path, 'utf-8'));\n  };\n  IdentityMetadataWrapper.verifySigner = function (contractKitOrAccountsWrapper, hash, signature, metadata) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2 /*return*/, this.verifySignerForAddress(contractKitOrAccountsWrapper, hash, signature, metadata.address)];\n      });\n    });\n  };\n  IdentityMetadataWrapper.verifySignerForAddress = function (contractKitOrAccountsWrapper, hash, signature, address) {\n    return __awaiter(this, void 0, void 0, function () {\n      var accounts, signers;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!!(0, signatureUtils_1.verifySignature)(hash, signature, address)) return [3 /*break*/, 5];\n            return [4 /*yield*/, getAccounts(contractKitOrAccountsWrapper)\n            // If this fails, signature may still be one of `address`' signers\n            ];\n\n          case 1:\n            accounts = _a.sent();\n            return [4 /*yield*/, accounts.isAccount(address)];\n          case 2:\n            if (!_a.sent()) return [3 /*break*/, 4];\n            return [4 /*yield*/, Promise.all([accounts.getVoteSigner(address), accounts.getValidatorSigner(address), accounts.getAttestationSigner(address)])];\n          case 3:\n            signers = _a.sent();\n            return [2 /*return*/, signers.some(function (signer) {\n              return (0, signatureUtils_1.verifySignature)(hash, signature, signer);\n            })];\n          case 4:\n            return [2 /*return*/, false];\n          case 5:\n            return [2 /*return*/, true];\n        }\n      });\n    });\n  };\n  IdentityMetadataWrapper.fromRawString = function (contractKitOrAccountsWrapper, rawData) {\n    return __awaiter(this, void 0, void 0, function () {\n      var data, validatedData, claims, hash, _a, res;\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            data = JSON.parse(rawData);\n            validatedData = exports.IdentityMetadataType.decode(data);\n            if ((0, Either_1.isLeft)(validatedData)) {\n              // TODO: We could probably return a more useful error in the future\n              throw new Error(PathReporter_1.PathReporter.report(validatedData).join(', '));\n            }\n            claims = validatedData.right.claims;\n            hash = (0, claim_1.hashOfClaims)(claims);\n            _a = claims.length > 0;\n            if (!_a) return [3 /*break*/, 2];\n            return [4 /*yield*/, this.verifySigner(contractKitOrAccountsWrapper, hash, validatedData.right.meta.signature, validatedData.right.meta)];\n          case 1:\n            _a = !_b.sent();\n            _b.label = 2;\n          case 2:\n            if (_a) {\n              throw new Error(\"Signature could not be validated. Guessing signer: \".concat((0, signatureUtils_1.guessSigner)(hash, validatedData.right.meta.signature)));\n            }\n            res = new IdentityMetadataWrapper(validatedData.right);\n            // Verify that singular claim types appear at most once\n            types_1.SINGULAR_CLAIM_TYPES.forEach(function (claimType) {\n              var results = res.filterClaims(claimType);\n              if (results.length > 1) {\n                throw new Error(\"Found \".concat(results.length, \" claims of type \").concat(claimType, \", should be at most 1\"));\n              }\n            });\n            return [2 /*return*/, res];\n        }\n      });\n    });\n  };\n  Object.defineProperty(IdentityMetadataWrapper.prototype, \"claims\", {\n    get: function get() {\n      return this.data.claims;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  IdentityMetadataWrapper.prototype.hashOfClaims = function () {\n    return (0, claim_1.hashOfClaims)(this.data.claims);\n  };\n  IdentityMetadataWrapper.prototype.toString = function () {\n    return JSON.stringify({\n      claims: this.data.claims,\n      meta: this.data.meta\n    });\n  };\n  IdentityMetadataWrapper.prototype.addClaim = function (claim, signer) {\n    return __awaiter(this, void 0, void 0, function () {\n      var existingClaims, existingClaims, index, _a;\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            switch (claim.type) {\n              case types_1.ClaimTypes.ACCOUNT:\n                if ((0, address_1.eqAddress)(claim.address, this.data.meta.address)) {\n                  throw new Error(\"Can't claim self\");\n                }\n                break;\n              case types_1.ClaimTypes.DOMAIN:\n                {\n                  existingClaims = this.data.claims.filter(function (el) {\n                    return el.domain === claim.domain;\n                  });\n                  if (existingClaims.length > 0) {\n                    return [2 /*return*/, existingClaims[0]];\n                  }\n                  break;\n                }\n              case types_1.ClaimTypes.KEYBASE:\n                {\n                  existingClaims = this.data.claims.filter(function (el) {\n                    return el.username === claim.username;\n                  });\n                  if (existingClaims.length > 0) {\n                    return [2 /*return*/, existingClaims[0]];\n                  }\n                }\n              default:\n                break;\n            }\n            if (types_1.SINGULAR_CLAIM_TYPES.includes(claim.type)) {\n              index = this.data.claims.findIndex((0, claim_1.isOfType)(claim.type));\n              if (index !== -1) {\n                this.data.claims.splice(index, 1);\n              }\n            }\n            this.data.claims.push(claim);\n            _a = this.data.meta;\n            return [4 /*yield*/, signer.sign(this.hashOfClaims())];\n          case 1:\n            _a.signature = _b.sent();\n            return [2 /*return*/, claim];\n        }\n      });\n    });\n  };\n  IdentityMetadataWrapper.prototype.findClaim = function (type) {\n    return this.data.claims.find((0, claim_1.isOfType)(type));\n  };\n  IdentityMetadataWrapper.prototype.filterClaims = function (type) {\n    return this.data.claims.filter((0, claim_1.isOfType)(type));\n  };\n  return IdentityMetadataWrapper;\n}();\nexports.IdentityMetadataWrapper = IdentityMetadataWrapper;\n// at first these functions required a `kit` but thats a bit heavy\n// as all that is used is the Accounts Wrapper so allow either.\nfunction getAccounts(contractKitOrAccountsWrapper) {\n  return __awaiter(this, void 0, void 0, function () {\n    return __generator(this, function (_a) {\n      if (contractKitOrAccountsWrapper instanceof Accounts_1.AccountsWrapper) {\n        return [2 /*return*/, contractKitOrAccountsWrapper];\n      } else {\n        return [2 /*return*/, contractKitOrAccountsWrapper.contracts.getAccounts()];\n      }\n      return [2 /*return*/];\n    });\n  });\n}","map":{"version":3,"names":["__createBinding","Object","create","o","m","k","k2","undefined","desc","getOwnPropertyDescriptor","__esModule","writable","configurable","enumerable","get","defineProperty","__setModuleDefault","v","value","__importStar","mod","result","prototype","hasOwnProperty","call","__awaiter","thisArg","_arguments","P","generator","adopt","resolve","Promise","reject","fulfilled","step","next","e","rejected","done","then","apply","__generator","body","_","label","sent","t","trys","ops","f","y","g","verb","Symbol","iterator","n","op","TypeError","pop","length","push","__importDefault","exports","IdentityMetadataWrapper","IdentityMetadataType","ClaimTypes","address_1","require","async_1","io_1","signatureUtils_1","cross_fetch_1","Either_1","PathReporter_1","Accounts_1","claim_1","types_1","types_2","MetaType","type","address","AddressType","signature","SignatureType","claims","array","ClaimType","meta","data","fromEmpty","fetchFromURL","contractKitOrAccountsWrapper","url","tries","_this","_a","selectiveRetryAsyncWithBackOff","resp","_b","_c","default","ok","Error","concat","status","fromRawString","text","fromFile","path","readFileSync","fs","console","error","verifySigner","hash","metadata","verifySignerForAddress","accounts","signers","verifySignature","getAccounts","isAccount","all","getVoteSigner","getValidatorSigner","getAttestationSigner","some","signer","rawData","validatedData","res","JSON","parse","decode","isLeft","PathReporter","report","join","right","hashOfClaims","guessSigner","SINGULAR_CLAIM_TYPES","forEach","claimType","results","filterClaims","toString","stringify","addClaim","claim","existingClaims","index","ACCOUNT","eqAddress","DOMAIN","filter","el","domain","KEYBASE","username","includes","findIndex","isOfType","splice","sign","findClaim","find","AccountsWrapper","contracts"],"sources":["/home/simone/Scrivania/progetti/HTB_challs/HackTheBoo_23/VeryEasy2/Brokenswap/frontend/node_modules/@celo/contractkit/lib/identity/metadata.js"],"sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.IdentityMetadataWrapper = exports.IdentityMetadataType = exports.ClaimTypes = void 0;\nvar address_1 = require(\"@celo/base/lib/address\");\nvar async_1 = require(\"@celo/base/lib/async\");\nvar io_1 = require(\"@celo/utils/lib/io\");\nvar signatureUtils_1 = require(\"@celo/utils/lib/signatureUtils\");\nvar cross_fetch_1 = __importDefault(require(\"cross-fetch\"));\nvar Either_1 = require(\"fp-ts/lib/Either\");\nvar t = __importStar(require(\"io-ts\"));\nvar PathReporter_1 = require(\"io-ts/lib/PathReporter\");\nvar Accounts_1 = require(\"../wrappers/Accounts\");\nvar claim_1 = require(\"./claims/claim\");\nvar types_1 = require(\"./claims/types\");\nvar types_2 = require(\"./claims/types\");\nObject.defineProperty(exports, \"ClaimTypes\", { enumerable: true, get: function () { return types_2.ClaimTypes; } });\nvar MetaType = t.type({\n    address: io_1.AddressType,\n    signature: io_1.SignatureType,\n});\nexports.IdentityMetadataType = t.type({\n    claims: t.array(claim_1.ClaimType),\n    meta: MetaType,\n});\nvar IdentityMetadataWrapper = /** @class */ (function () {\n    function IdentityMetadataWrapper(data) {\n        this.data = data;\n    }\n    IdentityMetadataWrapper.fromEmpty = function (address) {\n        return new IdentityMetadataWrapper({\n            claims: [],\n            meta: {\n                address: address,\n                signature: '',\n            },\n        });\n    };\n    IdentityMetadataWrapper.fetchFromURL = function (contractKitOrAccountsWrapper, url, tries) {\n        if (tries === void 0) { tries = 3; }\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                return [2 /*return*/, (0, async_1.selectiveRetryAsyncWithBackOff)(function () { return __awaiter(_this, void 0, void 0, function () {\n                        var resp, _a, _b;\n                        return __generator(this, function (_c) {\n                            switch (_c.label) {\n                                case 0: return [4 /*yield*/, (0, cross_fetch_1.default)(url)];\n                                case 1:\n                                    resp = _c.sent();\n                                    if (!resp.ok) {\n                                        throw new Error(\"Request failed with status \".concat(resp.status));\n                                    }\n                                    _a = this.fromRawString;\n                                    _b = [contractKitOrAccountsWrapper];\n                                    return [4 /*yield*/, resp.text()];\n                                case 2: return [2 /*return*/, _a.apply(this, _b.concat([_c.sent()]))];\n                            }\n                        });\n                    }); }, tries, ['Request failed with status 404'], [])];\n            });\n        });\n    };\n    IdentityMetadataWrapper.fromFile = function (contractKitOrAccountsWrapper, path) {\n        var readFileSync;\n        try {\n            var fs = require('fs');\n            readFileSync = fs.readFileSync;\n        }\n        catch (_a) {\n            console.error('cant read from file in browser or environment without native fs module');\n        }\n        return this.fromRawString(contractKitOrAccountsWrapper, readFileSync(path, 'utf-8'));\n    };\n    IdentityMetadataWrapper.verifySigner = function (contractKitOrAccountsWrapper, hash, signature, metadata) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.verifySignerForAddress(contractKitOrAccountsWrapper, hash, signature, metadata.address)];\n            });\n        });\n    };\n    IdentityMetadataWrapper.verifySignerForAddress = function (contractKitOrAccountsWrapper, hash, signature, address) {\n        return __awaiter(this, void 0, void 0, function () {\n            var accounts, signers;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!!(0, signatureUtils_1.verifySignature)(hash, signature, address)) return [3 /*break*/, 5];\n                        return [4 /*yield*/, getAccounts(contractKitOrAccountsWrapper)\n                            // If this fails, signature may still be one of `address`' signers\n                        ];\n                    case 1:\n                        accounts = _a.sent();\n                        return [4 /*yield*/, accounts.isAccount(address)];\n                    case 2:\n                        if (!_a.sent()) return [3 /*break*/, 4];\n                        return [4 /*yield*/, Promise.all([\n                                accounts.getVoteSigner(address),\n                                accounts.getValidatorSigner(address),\n                                accounts.getAttestationSigner(address),\n                            ])];\n                    case 3:\n                        signers = _a.sent();\n                        return [2 /*return*/, signers.some(function (signer) { return (0, signatureUtils_1.verifySignature)(hash, signature, signer); })];\n                    case 4: return [2 /*return*/, false];\n                    case 5: return [2 /*return*/, true];\n                }\n            });\n        });\n    };\n    IdentityMetadataWrapper.fromRawString = function (contractKitOrAccountsWrapper, rawData) {\n        return __awaiter(this, void 0, void 0, function () {\n            var data, validatedData, claims, hash, _a, res;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        data = JSON.parse(rawData);\n                        validatedData = exports.IdentityMetadataType.decode(data);\n                        if ((0, Either_1.isLeft)(validatedData)) {\n                            // TODO: We could probably return a more useful error in the future\n                            throw new Error(PathReporter_1.PathReporter.report(validatedData).join(', '));\n                        }\n                        claims = validatedData.right.claims;\n                        hash = (0, claim_1.hashOfClaims)(claims);\n                        _a = claims.length > 0;\n                        if (!_a) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.verifySigner(contractKitOrAccountsWrapper, hash, validatedData.right.meta.signature, validatedData.right.meta)];\n                    case 1:\n                        _a = !(_b.sent());\n                        _b.label = 2;\n                    case 2:\n                        if (_a) {\n                            throw new Error(\"Signature could not be validated. Guessing signer: \".concat((0, signatureUtils_1.guessSigner)(hash, validatedData.right.meta.signature)));\n                        }\n                        res = new IdentityMetadataWrapper(validatedData.right);\n                        // Verify that singular claim types appear at most once\n                        types_1.SINGULAR_CLAIM_TYPES.forEach(function (claimType) {\n                            var results = res.filterClaims(claimType);\n                            if (results.length > 1) {\n                                throw new Error(\"Found \".concat(results.length, \" claims of type \").concat(claimType, \", should be at most 1\"));\n                            }\n                        });\n                        return [2 /*return*/, res];\n                }\n            });\n        });\n    };\n    Object.defineProperty(IdentityMetadataWrapper.prototype, \"claims\", {\n        get: function () {\n            return this.data.claims;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    IdentityMetadataWrapper.prototype.hashOfClaims = function () {\n        return (0, claim_1.hashOfClaims)(this.data.claims);\n    };\n    IdentityMetadataWrapper.prototype.toString = function () {\n        return JSON.stringify({\n            claims: this.data.claims,\n            meta: this.data.meta,\n        });\n    };\n    IdentityMetadataWrapper.prototype.addClaim = function (claim, signer) {\n        return __awaiter(this, void 0, void 0, function () {\n            var existingClaims, existingClaims, index, _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        switch (claim.type) {\n                            case types_1.ClaimTypes.ACCOUNT:\n                                if ((0, address_1.eqAddress)(claim.address, this.data.meta.address)) {\n                                    throw new Error(\"Can't claim self\");\n                                }\n                                break;\n                            case types_1.ClaimTypes.DOMAIN: {\n                                existingClaims = this.data.claims.filter(function (el) { return el.domain === claim.domain; });\n                                if (existingClaims.length > 0) {\n                                    return [2 /*return*/, existingClaims[0]];\n                                }\n                                break;\n                            }\n                            case types_1.ClaimTypes.KEYBASE: {\n                                existingClaims = this.data.claims.filter(function (el) { return el.username === claim.username; });\n                                if (existingClaims.length > 0) {\n                                    return [2 /*return*/, existingClaims[0]];\n                                }\n                            }\n                            default:\n                                break;\n                        }\n                        if (types_1.SINGULAR_CLAIM_TYPES.includes(claim.type)) {\n                            index = this.data.claims.findIndex((0, claim_1.isOfType)(claim.type));\n                            if (index !== -1) {\n                                this.data.claims.splice(index, 1);\n                            }\n                        }\n                        this.data.claims.push(claim);\n                        _a = this.data.meta;\n                        return [4 /*yield*/, signer.sign(this.hashOfClaims())];\n                    case 1:\n                        _a.signature = _b.sent();\n                        return [2 /*return*/, claim];\n                }\n            });\n        });\n    };\n    IdentityMetadataWrapper.prototype.findClaim = function (type) {\n        return this.data.claims.find((0, claim_1.isOfType)(type));\n    };\n    IdentityMetadataWrapper.prototype.filterClaims = function (type) {\n        return this.data.claims.filter((0, claim_1.isOfType)(type));\n    };\n    return IdentityMetadataWrapper;\n}());\nexports.IdentityMetadataWrapper = IdentityMetadataWrapper;\n// at first these functions required a `kit` but thats a bit heavy\n// as all that is used is the Accounts Wrapper so allow either.\nfunction getAccounts(contractKitOrAccountsWrapper) {\n    return __awaiter(this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            if (contractKitOrAccountsWrapper instanceof Accounts_1.AccountsWrapper) {\n                return [2 /*return*/, contractKitOrAccountsWrapper];\n            }\n            else {\n                return [2 /*return*/, contractKitOrAccountsWrapper.contracts.getAccounts()];\n            }\n            return [2 /*return*/];\n        });\n    });\n}\n//# sourceMappingURL=metadata.js.map"],"mappings":"AAAA,YAAY;;AACZ,IAAIA,eAAe,GAAI,IAAI,IAAI,IAAI,CAACA,eAAe,KAAMC,MAAM,CAACC,MAAM,GAAI,UAASC,CAAC,EAAEC,CAAC,EAAEC,CAAC,EAAEC,EAAE,EAAE;EAC5F,IAAIA,EAAE,KAAKC,SAAS,EAAED,EAAE,GAAGD,CAAC;EAC5B,IAAIG,IAAI,GAAGP,MAAM,CAACQ,wBAAwB,CAACL,CAAC,EAAEC,CAAC,CAAC;EAChD,IAAI,CAACG,IAAI,KAAK,KAAK,IAAIA,IAAI,GAAG,CAACJ,CAAC,CAACM,UAAU,GAAGF,IAAI,CAACG,QAAQ,IAAIH,IAAI,CAACI,YAAY,CAAC,EAAE;IACjFJ,IAAI,GAAG;MAAEK,UAAU,EAAE,IAAI;MAAEC,GAAG,EAAE,SAAAA,IAAA,EAAW;QAAE,OAAOV,CAAC,CAACC,CAAC,CAAC;MAAE;IAAE,CAAC;EAC/D;EACAJ,MAAM,CAACc,cAAc,CAACZ,CAAC,EAAEG,EAAE,EAAEE,IAAI,CAAC;AACtC,CAAC,GAAK,UAASL,CAAC,EAAEC,CAAC,EAAEC,CAAC,EAAEC,EAAE,EAAE;EACxB,IAAIA,EAAE,KAAKC,SAAS,EAAED,EAAE,GAAGD,CAAC;EAC5BF,CAAC,CAACG,EAAE,CAAC,GAAGF,CAAC,CAACC,CAAC,CAAC;AAChB,CAAE,CAAC;AACH,IAAIW,kBAAkB,GAAI,IAAI,IAAI,IAAI,CAACA,kBAAkB,KAAMf,MAAM,CAACC,MAAM,GAAI,UAASC,CAAC,EAAEc,CAAC,EAAE;EAC3FhB,MAAM,CAACc,cAAc,CAACZ,CAAC,EAAE,SAAS,EAAE;IAAEU,UAAU,EAAE,IAAI;IAAEK,KAAK,EAAED;EAAE,CAAC,CAAC;AACvE,CAAC,GAAI,UAASd,CAAC,EAAEc,CAAC,EAAE;EAChBd,CAAC,CAAC,SAAS,CAAC,GAAGc,CAAC;AACpB,CAAC,CAAC;AACF,IAAIE,YAAY,GAAI,IAAI,IAAI,IAAI,CAACA,YAAY,IAAK,UAAUC,GAAG,EAAE;EAC7D,IAAIA,GAAG,IAAIA,GAAG,CAACV,UAAU,EAAE,OAAOU,GAAG;EACrC,IAAIC,MAAM,GAAG,CAAC,CAAC;EACf,IAAID,GAAG,IAAI,IAAI,EAAE,KAAK,IAAIf,CAAC,IAAIe,GAAG,EAAE,IAAIf,CAAC,KAAK,SAAS,IAAIJ,MAAM,CAACqB,SAAS,CAACC,cAAc,CAACC,IAAI,CAACJ,GAAG,EAAEf,CAAC,CAAC,EAAEL,eAAe,CAACqB,MAAM,EAAED,GAAG,EAAEf,CAAC,CAAC;EACxIW,kBAAkB,CAACK,MAAM,EAAED,GAAG,CAAC;EAC/B,OAAOC,MAAM;AACjB,CAAC;AACD,IAAII,SAAS,GAAI,IAAI,IAAI,IAAI,CAACA,SAAS,IAAK,UAAUC,OAAO,EAAEC,UAAU,EAAEC,CAAC,EAAEC,SAAS,EAAE;EACrF,SAASC,KAAKA,CAACZ,KAAK,EAAE;IAAE,OAAOA,KAAK,YAAYU,CAAC,GAAGV,KAAK,GAAG,IAAIU,CAAC,CAAC,UAAUG,OAAO,EAAE;MAAEA,OAAO,CAACb,KAAK,CAAC;IAAE,CAAC,CAAC;EAAE;EAC3G,OAAO,KAAKU,CAAC,KAAKA,CAAC,GAAGI,OAAO,CAAC,EAAE,UAAUD,OAAO,EAAEE,MAAM,EAAE;IACvD,SAASC,SAASA,CAAChB,KAAK,EAAE;MAAE,IAAI;QAAEiB,IAAI,CAACN,SAAS,CAACO,IAAI,CAAClB,KAAK,CAAC,CAAC;MAAE,CAAC,CAAC,OAAOmB,CAAC,EAAE;QAAEJ,MAAM,CAACI,CAAC,CAAC;MAAE;IAAE;IAC1F,SAASC,QAAQA,CAACpB,KAAK,EAAE;MAAE,IAAI;QAAEiB,IAAI,CAACN,SAAS,CAAC,OAAO,CAAC,CAACX,KAAK,CAAC,CAAC;MAAE,CAAC,CAAC,OAAOmB,CAAC,EAAE;QAAEJ,MAAM,CAACI,CAAC,CAAC;MAAE;IAAE;IAC7F,SAASF,IAAIA,CAACd,MAAM,EAAE;MAAEA,MAAM,CAACkB,IAAI,GAAGR,OAAO,CAACV,MAAM,CAACH,KAAK,CAAC,GAAGY,KAAK,CAACT,MAAM,CAACH,KAAK,CAAC,CAACsB,IAAI,CAACN,SAAS,EAAEI,QAAQ,CAAC;IAAE;IAC7GH,IAAI,CAAC,CAACN,SAAS,GAAGA,SAAS,CAACY,KAAK,CAACf,OAAO,EAAEC,UAAU,IAAI,EAAE,CAAC,EAAES,IAAI,CAAC,CAAC,CAAC;EACzE,CAAC,CAAC;AACN,CAAC;AACD,IAAIM,WAAW,GAAI,IAAI,IAAI,IAAI,CAACA,WAAW,IAAK,UAAUhB,OAAO,EAAEiB,IAAI,EAAE;EACrE,IAAIC,CAAC,GAAG;MAAEC,KAAK,EAAE,CAAC;MAAEC,IAAI,EAAE,SAAAA,KAAA,EAAW;QAAE,IAAIC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,MAAMA,CAAC,CAAC,CAAC,CAAC;QAAE,OAAOA,CAAC,CAAC,CAAC,CAAC;MAAE,CAAC;MAAEC,IAAI,EAAE,EAAE;MAAEC,GAAG,EAAE;IAAG,CAAC;IAAEC,CAAC;IAAEC,CAAC;IAAEJ,CAAC;IAAEK,CAAC;EAChH,OAAOA,CAAC,GAAG;IAAEhB,IAAI,EAAEiB,IAAI,CAAC,CAAC,CAAC;IAAE,OAAO,EAAEA,IAAI,CAAC,CAAC,CAAC;IAAE,QAAQ,EAAEA,IAAI,CAAC,CAAC;EAAE,CAAC,EAAE,OAAOC,MAAM,KAAK,UAAU,KAAKF,CAAC,CAACE,MAAM,CAACC,QAAQ,CAAC,GAAG,YAAW;IAAE,OAAO,IAAI;EAAE,CAAC,CAAC,EAAEH,CAAC;EACxJ,SAASC,IAAIA,CAACG,CAAC,EAAE;IAAE,OAAO,UAAUvC,CAAC,EAAE;MAAE,OAAOkB,IAAI,CAAC,CAACqB,CAAC,EAAEvC,CAAC,CAAC,CAAC;IAAE,CAAC;EAAE;EACjE,SAASkB,IAAIA,CAACsB,EAAE,EAAE;IACd,IAAIP,CAAC,EAAE,MAAM,IAAIQ,SAAS,CAAC,iCAAiC,CAAC;IAC7D,OAAOd,CAAC,EAAE,IAAI;MACV,IAAIM,CAAC,GAAG,CAAC,EAAEC,CAAC,KAAKJ,CAAC,GAAGU,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,GAAGN,CAAC,CAAC,QAAQ,CAAC,GAAGM,EAAE,CAAC,CAAC,CAAC,GAAGN,CAAC,CAAC,OAAO,CAAC,KAAK,CAACJ,CAAC,GAAGI,CAAC,CAAC,QAAQ,CAAC,KAAKJ,CAAC,CAACvB,IAAI,CAAC2B,CAAC,CAAC,EAAE,CAAC,CAAC,GAAGA,CAAC,CAACf,IAAI,CAAC,IAAI,CAAC,CAACW,CAAC,GAAGA,CAAC,CAACvB,IAAI,CAAC2B,CAAC,EAAEM,EAAE,CAAC,CAAC,CAAC,CAAC,EAAElB,IAAI,EAAE,OAAOQ,CAAC;MAC5J,IAAII,CAAC,GAAG,CAAC,EAAEJ,CAAC,EAAEU,EAAE,GAAG,CAACA,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,EAAEV,CAAC,CAAC7B,KAAK,CAAC;MACvC,QAAQuC,EAAE,CAAC,CAAC,CAAC;QACT,KAAK,CAAC;QAAE,KAAK,CAAC;UAAEV,CAAC,GAAGU,EAAE;UAAE;QACxB,KAAK,CAAC;UAAEb,CAAC,CAACC,KAAK,EAAE;UAAE,OAAO;YAAE3B,KAAK,EAAEuC,EAAE,CAAC,CAAC,CAAC;YAAElB,IAAI,EAAE;UAAM,CAAC;QACvD,KAAK,CAAC;UAAEK,CAAC,CAACC,KAAK,EAAE;UAAEM,CAAC,GAAGM,EAAE,CAAC,CAAC,CAAC;UAAEA,EAAE,GAAG,CAAC,CAAC,CAAC;UAAE;QACxC,KAAK,CAAC;UAAEA,EAAE,GAAGb,CAAC,CAACK,GAAG,CAACU,GAAG,CAAC,CAAC;UAAEf,CAAC,CAACI,IAAI,CAACW,GAAG,CAAC,CAAC;UAAE;QACxC;UACI,IAAI,EAAEZ,CAAC,GAAGH,CAAC,CAACI,IAAI,EAAED,CAAC,GAAGA,CAAC,CAACa,MAAM,GAAG,CAAC,IAAIb,CAAC,CAACA,CAAC,CAACa,MAAM,GAAG,CAAC,CAAC,CAAC,KAAKH,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,IAAIA,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE;YAAEb,CAAC,GAAG,CAAC;YAAE;UAAU;UAC3G,IAAIa,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,CAACV,CAAC,IAAKU,EAAE,CAAC,CAAC,CAAC,GAAGV,CAAC,CAAC,CAAC,CAAC,IAAIU,EAAE,CAAC,CAAC,CAAC,GAAGV,CAAC,CAAC,CAAC,CAAE,CAAC,EAAE;YAAEH,CAAC,CAACC,KAAK,GAAGY,EAAE,CAAC,CAAC,CAAC;YAAE;UAAO;UACrF,IAAIA,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,IAAIb,CAAC,CAACC,KAAK,GAAGE,CAAC,CAAC,CAAC,CAAC,EAAE;YAAEH,CAAC,CAACC,KAAK,GAAGE,CAAC,CAAC,CAAC,CAAC;YAAEA,CAAC,GAAGU,EAAE;YAAE;UAAO;UACpE,IAAIV,CAAC,IAAIH,CAAC,CAACC,KAAK,GAAGE,CAAC,CAAC,CAAC,CAAC,EAAE;YAAEH,CAAC,CAACC,KAAK,GAAGE,CAAC,CAAC,CAAC,CAAC;YAAEH,CAAC,CAACK,GAAG,CAACY,IAAI,CAACJ,EAAE,CAAC;YAAE;UAAO;UAClE,IAAIV,CAAC,CAAC,CAAC,CAAC,EAAEH,CAAC,CAACK,GAAG,CAACU,GAAG,CAAC,CAAC;UACrBf,CAAC,CAACI,IAAI,CAACW,GAAG,CAAC,CAAC;UAAE;MACtB;MACAF,EAAE,GAAGd,IAAI,CAACnB,IAAI,CAACE,OAAO,EAAEkB,CAAC,CAAC;IAC9B,CAAC,CAAC,OAAOP,CAAC,EAAE;MAAEoB,EAAE,GAAG,CAAC,CAAC,EAAEpB,CAAC,CAAC;MAAEc,CAAC,GAAG,CAAC;IAAE,CAAC,SAAS;MAAED,CAAC,GAAGH,CAAC,GAAG,CAAC;IAAE;IACzD,IAAIU,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,MAAMA,EAAE,CAAC,CAAC,CAAC;IAAE,OAAO;MAAEvC,KAAK,EAAEuC,EAAE,CAAC,CAAC,CAAC,GAAGA,EAAE,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC;MAAElB,IAAI,EAAE;IAAK,CAAC;EACpF;AACJ,CAAC;AACD,IAAIuB,eAAe,GAAI,IAAI,IAAI,IAAI,CAACA,eAAe,IAAK,UAAU1C,GAAG,EAAE;EACnE,OAAQA,GAAG,IAAIA,GAAG,CAACV,UAAU,GAAIU,GAAG,GAAG;IAAE,SAAS,EAAEA;EAAI,CAAC;AAC7D,CAAC;AACDnB,MAAM,CAACc,cAAc,CAACgD,OAAO,EAAE,YAAY,EAAE;EAAE7C,KAAK,EAAE;AAAK,CAAC,CAAC;AAC7D6C,OAAO,CAACC,uBAAuB,GAAGD,OAAO,CAACE,oBAAoB,GAAGF,OAAO,CAACG,UAAU,GAAG,KAAK,CAAC;AAC5F,IAAIC,SAAS,GAAGC,OAAO,CAAC,wBAAwB,CAAC;AACjD,IAAIC,OAAO,GAAGD,OAAO,CAAC,sBAAsB,CAAC;AAC7C,IAAIE,IAAI,GAAGF,OAAO,CAAC,oBAAoB,CAAC;AACxC,IAAIG,gBAAgB,GAAGH,OAAO,CAAC,gCAAgC,CAAC;AAChE,IAAII,aAAa,GAAGV,eAAe,CAACM,OAAO,CAAC,aAAa,CAAC,CAAC;AAC3D,IAAIK,QAAQ,GAAGL,OAAO,CAAC,kBAAkB,CAAC;AAC1C,IAAIrB,CAAC,GAAG5B,YAAY,CAACiD,OAAO,CAAC,OAAO,CAAC,CAAC;AACtC,IAAIM,cAAc,GAAGN,OAAO,CAAC,wBAAwB,CAAC;AACtD,IAAIO,UAAU,GAAGP,OAAO,CAAC,sBAAsB,CAAC;AAChD,IAAIQ,OAAO,GAAGR,OAAO,CAAC,gBAAgB,CAAC;AACvC,IAAIS,OAAO,GAAGT,OAAO,CAAC,gBAAgB,CAAC;AACvC,IAAIU,OAAO,GAAGV,OAAO,CAAC,gBAAgB,CAAC;AACvCnE,MAAM,CAACc,cAAc,CAACgD,OAAO,EAAE,YAAY,EAAE;EAAElD,UAAU,EAAE,IAAI;EAAEC,GAAG,EAAE,SAAAA,IAAA,EAAY;IAAE,OAAOgE,OAAO,CAACZ,UAAU;EAAE;AAAE,CAAC,CAAC;AACnH,IAAIa,QAAQ,GAAGhC,CAAC,CAACiC,IAAI,CAAC;EAClBC,OAAO,EAAEX,IAAI,CAACY,WAAW;EACzBC,SAAS,EAAEb,IAAI,CAACc;AACpB,CAAC,CAAC;AACFrB,OAAO,CAACE,oBAAoB,GAAGlB,CAAC,CAACiC,IAAI,CAAC;EAClCK,MAAM,EAAEtC,CAAC,CAACuC,KAAK,CAACV,OAAO,CAACW,SAAS,CAAC;EAClCC,IAAI,EAAET;AACV,CAAC,CAAC;AACF,IAAIf,uBAAuB,GAAG,aAAe,YAAY;EACrD,SAASA,uBAAuBA,CAACyB,IAAI,EAAE;IACnC,IAAI,CAACA,IAAI,GAAGA,IAAI;EACpB;EACAzB,uBAAuB,CAAC0B,SAAS,GAAG,UAAUT,OAAO,EAAE;IACnD,OAAO,IAAIjB,uBAAuB,CAAC;MAC/BqB,MAAM,EAAE,EAAE;MACVG,IAAI,EAAE;QACFP,OAAO,EAAEA,OAAO;QAChBE,SAAS,EAAE;MACf;IACJ,CAAC,CAAC;EACN,CAAC;EACDnB,uBAAuB,CAAC2B,YAAY,GAAG,UAAUC,4BAA4B,EAAEC,GAAG,EAAEC,KAAK,EAAE;IACvF,IAAIA,KAAK,KAAK,KAAK,CAAC,EAAE;MAAEA,KAAK,GAAG,CAAC;IAAE;IACnC,OAAOrE,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,YAAY;MAC/C,IAAIsE,KAAK,GAAG,IAAI;MAChB,OAAOrD,WAAW,CAAC,IAAI,EAAE,UAAUsD,EAAE,EAAE;QACnC,OAAO,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,EAAE3B,OAAO,CAAC4B,8BAA8B,EAAE,YAAY;UAAE,OAAOxE,SAAS,CAACsE,KAAK,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,YAAY;YAC5H,IAAIG,IAAI,EAAEF,EAAE,EAAEG,EAAE;YAChB,OAAOzD,WAAW,CAAC,IAAI,EAAE,UAAU0D,EAAE,EAAE;cACnC,QAAQA,EAAE,CAACvD,KAAK;gBACZ,KAAK,CAAC;kBAAE,OAAO,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,EAAE2B,aAAa,CAAC6B,OAAO,EAAER,GAAG,CAAC,CAAC;gBAC7D,KAAK,CAAC;kBACFK,IAAI,GAAGE,EAAE,CAACtD,IAAI,CAAC,CAAC;kBAChB,IAAI,CAACoD,IAAI,CAACI,EAAE,EAAE;oBACV,MAAM,IAAIC,KAAK,CAAC,6BAA6B,CAACC,MAAM,CAACN,IAAI,CAACO,MAAM,CAAC,CAAC;kBACtE;kBACAT,EAAE,GAAG,IAAI,CAACU,aAAa;kBACvBP,EAAE,GAAG,CAACP,4BAA4B,CAAC;kBACnC,OAAO,CAAC,CAAC,CAAC,WAAWM,IAAI,CAACS,IAAI,CAAC,CAAC,CAAC;gBACrC,KAAK,CAAC;kBAAE,OAAO,CAAC,CAAC,CAAC,YAAYX,EAAE,CAACvD,KAAK,CAAC,IAAI,EAAE0D,EAAE,CAACK,MAAM,CAAC,CAACJ,EAAE,CAACtD,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;cACzE;YACJ,CAAC,CAAC;UACN,CAAC,CAAC;QAAE,CAAC,EAAEgD,KAAK,EAAE,CAAC,gCAAgC,CAAC,EAAE,EAAE,CAAC,CAAC;MAC9D,CAAC,CAAC;IACN,CAAC,CAAC;EACN,CAAC;EACD9B,uBAAuB,CAAC4C,QAAQ,GAAG,UAAUhB,4BAA4B,EAAEiB,IAAI,EAAE;IAC7E,IAAIC,YAAY;IAChB,IAAI;MACA,IAAIC,EAAE,GAAG3C,OAAO,CAAC,IAAI,CAAC;MACtB0C,YAAY,GAAGC,EAAE,CAACD,YAAY;IAClC,CAAC,CACD,OAAOd,EAAE,EAAE;MACPgB,OAAO,CAACC,KAAK,CAAC,wEAAwE,CAAC;IAC3F;IACA,OAAO,IAAI,CAACP,aAAa,CAACd,4BAA4B,EAAEkB,YAAY,CAACD,IAAI,EAAE,OAAO,CAAC,CAAC;EACxF,CAAC;EACD7C,uBAAuB,CAACkD,YAAY,GAAG,UAAUtB,4BAA4B,EAAEuB,IAAI,EAAEhC,SAAS,EAAEiC,QAAQ,EAAE;IACtG,OAAO3F,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,YAAY;MAC/C,OAAOiB,WAAW,CAAC,IAAI,EAAE,UAAUsD,EAAE,EAAE;QACnC,OAAO,CAAC,CAAC,CAAC,YAAY,IAAI,CAACqB,sBAAsB,CAACzB,4BAA4B,EAAEuB,IAAI,EAAEhC,SAAS,EAAEiC,QAAQ,CAACnC,OAAO,CAAC,CAAC;MACvH,CAAC,CAAC;IACN,CAAC,CAAC;EACN,CAAC;EACDjB,uBAAuB,CAACqD,sBAAsB,GAAG,UAAUzB,4BAA4B,EAAEuB,IAAI,EAAEhC,SAAS,EAAEF,OAAO,EAAE;IAC/G,OAAOxD,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,YAAY;MAC/C,IAAI6F,QAAQ,EAAEC,OAAO;MACrB,OAAO7E,WAAW,CAAC,IAAI,EAAE,UAAUsD,EAAE,EAAE;QACnC,QAAQA,EAAE,CAACnD,KAAK;UACZ,KAAK,CAAC;YACF,IAAI,CAAC,CAAC,CAAC,CAAC,EAAE0B,gBAAgB,CAACiD,eAAe,EAAEL,IAAI,EAAEhC,SAAS,EAAEF,OAAO,CAAC,EAAE,OAAO,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC;YAC9F,OAAO,CAAC,CAAC,CAAC,WAAWwC,WAAW,CAAC7B,4BAA4B;YACzD;YAAA,CACH;;UACL,KAAK,CAAC;YACF0B,QAAQ,GAAGtB,EAAE,CAAClD,IAAI,CAAC,CAAC;YACpB,OAAO,CAAC,CAAC,CAAC,WAAWwE,QAAQ,CAACI,SAAS,CAACzC,OAAO,CAAC,CAAC;UACrD,KAAK,CAAC;YACF,IAAI,CAACe,EAAE,CAAClD,IAAI,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC;YACvC,OAAO,CAAC,CAAC,CAAC,WAAWd,OAAO,CAAC2F,GAAG,CAAC,CACzBL,QAAQ,CAACM,aAAa,CAAC3C,OAAO,CAAC,EAC/BqC,QAAQ,CAACO,kBAAkB,CAAC5C,OAAO,CAAC,EACpCqC,QAAQ,CAACQ,oBAAoB,CAAC7C,OAAO,CAAC,CACzC,CAAC,CAAC;UACX,KAAK,CAAC;YACFsC,OAAO,GAAGvB,EAAE,CAAClD,IAAI,CAAC,CAAC;YACnB,OAAO,CAAC,CAAC,CAAC,YAAYyE,OAAO,CAACQ,IAAI,CAAC,UAAUC,MAAM,EAAE;cAAE,OAAO,CAAC,CAAC,EAAEzD,gBAAgB,CAACiD,eAAe,EAAEL,IAAI,EAAEhC,SAAS,EAAE6C,MAAM,CAAC;YAAE,CAAC,CAAC,CAAC;UACrI,KAAK,CAAC;YAAE,OAAO,CAAC,CAAC,CAAC,YAAY,KAAK,CAAC;UACpC,KAAK,CAAC;YAAE,OAAO,CAAC,CAAC,CAAC,YAAY,IAAI,CAAC;QACvC;MACJ,CAAC,CAAC;IACN,CAAC,CAAC;EACN,CAAC;EACDhE,uBAAuB,CAAC0C,aAAa,GAAG,UAAUd,4BAA4B,EAAEqC,OAAO,EAAE;IACrF,OAAOxG,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,YAAY;MAC/C,IAAIgE,IAAI,EAAEyC,aAAa,EAAE7C,MAAM,EAAE8B,IAAI,EAAEnB,EAAE,EAAEmC,GAAG;MAC9C,OAAOzF,WAAW,CAAC,IAAI,EAAE,UAAUyD,EAAE,EAAE;QACnC,QAAQA,EAAE,CAACtD,KAAK;UACZ,KAAK,CAAC;YACF4C,IAAI,GAAG2C,IAAI,CAACC,KAAK,CAACJ,OAAO,CAAC;YAC1BC,aAAa,GAAGnE,OAAO,CAACE,oBAAoB,CAACqE,MAAM,CAAC7C,IAAI,CAAC;YACzD,IAAI,CAAC,CAAC,EAAEhB,QAAQ,CAAC8D,MAAM,EAAEL,aAAa,CAAC,EAAE;cACrC;cACA,MAAM,IAAI3B,KAAK,CAAC7B,cAAc,CAAC8D,YAAY,CAACC,MAAM,CAACP,aAAa,CAAC,CAACQ,IAAI,CAAC,IAAI,CAAC,CAAC;YACjF;YACArD,MAAM,GAAG6C,aAAa,CAACS,KAAK,CAACtD,MAAM;YACnC8B,IAAI,GAAG,CAAC,CAAC,EAAEvC,OAAO,CAACgE,YAAY,EAAEvD,MAAM,CAAC;YACxCW,EAAE,GAAGX,MAAM,CAACzB,MAAM,GAAG,CAAC;YACtB,IAAI,CAACoC,EAAE,EAAE,OAAO,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC;YAChC,OAAO,CAAC,CAAC,CAAC,WAAW,IAAI,CAACkB,YAAY,CAACtB,4BAA4B,EAAEuB,IAAI,EAAEe,aAAa,CAACS,KAAK,CAACnD,IAAI,CAACL,SAAS,EAAE+C,aAAa,CAACS,KAAK,CAACnD,IAAI,CAAC,CAAC;UAC7I,KAAK,CAAC;YACFQ,EAAE,GAAG,CAAEG,EAAE,CAACrD,IAAI,CAAC,CAAE;YACjBqD,EAAE,CAACtD,KAAK,GAAG,CAAC;UAChB,KAAK,CAAC;YACF,IAAImD,EAAE,EAAE;cACJ,MAAM,IAAIO,KAAK,CAAC,qDAAqD,CAACC,MAAM,CAAC,CAAC,CAAC,EAAEjC,gBAAgB,CAACsE,WAAW,EAAE1B,IAAI,EAAEe,aAAa,CAACS,KAAK,CAACnD,IAAI,CAACL,SAAS,CAAC,CAAC,CAAC;YAC9J;YACAgD,GAAG,GAAG,IAAInE,uBAAuB,CAACkE,aAAa,CAACS,KAAK,CAAC;YACtD;YACA9D,OAAO,CAACiE,oBAAoB,CAACC,OAAO,CAAC,UAAUC,SAAS,EAAE;cACtD,IAAIC,OAAO,GAAGd,GAAG,CAACe,YAAY,CAACF,SAAS,CAAC;cACzC,IAAIC,OAAO,CAACrF,MAAM,GAAG,CAAC,EAAE;gBACpB,MAAM,IAAI2C,KAAK,CAAC,QAAQ,CAACC,MAAM,CAACyC,OAAO,CAACrF,MAAM,EAAE,kBAAkB,CAAC,CAAC4C,MAAM,CAACwC,SAAS,EAAE,uBAAuB,CAAC,CAAC;cACnH;YACJ,CAAC,CAAC;YACF,OAAO,CAAC,CAAC,CAAC,YAAYb,GAAG,CAAC;QAClC;MACJ,CAAC,CAAC;IACN,CAAC,CAAC;EACN,CAAC;EACDlI,MAAM,CAACc,cAAc,CAACiD,uBAAuB,CAAC1C,SAAS,EAAE,QAAQ,EAAE;IAC/DR,GAAG,EAAE,SAAAA,IAAA,EAAY;MACb,OAAO,IAAI,CAAC2E,IAAI,CAACJ,MAAM;IAC3B,CAAC;IACDxE,UAAU,EAAE,KAAK;IACjBD,YAAY,EAAE;EAClB,CAAC,CAAC;EACFoD,uBAAuB,CAAC1C,SAAS,CAACsH,YAAY,GAAG,YAAY;IACzD,OAAO,CAAC,CAAC,EAAEhE,OAAO,CAACgE,YAAY,EAAE,IAAI,CAACnD,IAAI,CAACJ,MAAM,CAAC;EACtD,CAAC;EACDrB,uBAAuB,CAAC1C,SAAS,CAAC6H,QAAQ,GAAG,YAAY;IACrD,OAAOf,IAAI,CAACgB,SAAS,CAAC;MAClB/D,MAAM,EAAE,IAAI,CAACI,IAAI,CAACJ,MAAM;MACxBG,IAAI,EAAE,IAAI,CAACC,IAAI,CAACD;IACpB,CAAC,CAAC;EACN,CAAC;EACDxB,uBAAuB,CAAC1C,SAAS,CAAC+H,QAAQ,GAAG,UAAUC,KAAK,EAAEtB,MAAM,EAAE;IAClE,OAAOvG,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,YAAY;MAC/C,IAAI8H,cAAc,EAAEA,cAAc,EAAEC,KAAK,EAAExD,EAAE;MAC7C,OAAOtD,WAAW,CAAC,IAAI,EAAE,UAAUyD,EAAE,EAAE;QACnC,QAAQA,EAAE,CAACtD,KAAK;UACZ,KAAK,CAAC;YACF,QAAQyG,KAAK,CAACtE,IAAI;cACd,KAAKH,OAAO,CAACX,UAAU,CAACuF,OAAO;gBAC3B,IAAI,CAAC,CAAC,EAAEtF,SAAS,CAACuF,SAAS,EAAEJ,KAAK,CAACrE,OAAO,EAAE,IAAI,CAACQ,IAAI,CAACD,IAAI,CAACP,OAAO,CAAC,EAAE;kBACjE,MAAM,IAAIsB,KAAK,CAAC,kBAAkB,CAAC;gBACvC;gBACA;cACJ,KAAK1B,OAAO,CAACX,UAAU,CAACyF,MAAM;gBAAE;kBAC5BJ,cAAc,GAAG,IAAI,CAAC9D,IAAI,CAACJ,MAAM,CAACuE,MAAM,CAAC,UAAUC,EAAE,EAAE;oBAAE,OAAOA,EAAE,CAACC,MAAM,KAAKR,KAAK,CAACQ,MAAM;kBAAE,CAAC,CAAC;kBAC9F,IAAIP,cAAc,CAAC3F,MAAM,GAAG,CAAC,EAAE;oBAC3B,OAAO,CAAC,CAAC,CAAC,YAAY2F,cAAc,CAAC,CAAC,CAAC,CAAC;kBAC5C;kBACA;gBACJ;cACA,KAAK1E,OAAO,CAACX,UAAU,CAAC6F,OAAO;gBAAE;kBAC7BR,cAAc,GAAG,IAAI,CAAC9D,IAAI,CAACJ,MAAM,CAACuE,MAAM,CAAC,UAAUC,EAAE,EAAE;oBAAE,OAAOA,EAAE,CAACG,QAAQ,KAAKV,KAAK,CAACU,QAAQ;kBAAE,CAAC,CAAC;kBAClG,IAAIT,cAAc,CAAC3F,MAAM,GAAG,CAAC,EAAE;oBAC3B,OAAO,CAAC,CAAC,CAAC,YAAY2F,cAAc,CAAC,CAAC,CAAC,CAAC;kBAC5C;gBACJ;cACA;gBACI;YACR;YACA,IAAI1E,OAAO,CAACiE,oBAAoB,CAACmB,QAAQ,CAACX,KAAK,CAACtE,IAAI,CAAC,EAAE;cACnDwE,KAAK,GAAG,IAAI,CAAC/D,IAAI,CAACJ,MAAM,CAAC6E,SAAS,CAAC,CAAC,CAAC,EAAEtF,OAAO,CAACuF,QAAQ,EAAEb,KAAK,CAACtE,IAAI,CAAC,CAAC;cACrE,IAAIwE,KAAK,KAAK,CAAC,CAAC,EAAE;gBACd,IAAI,CAAC/D,IAAI,CAACJ,MAAM,CAAC+E,MAAM,CAACZ,KAAK,EAAE,CAAC,CAAC;cACrC;YACJ;YACA,IAAI,CAAC/D,IAAI,CAACJ,MAAM,CAACxB,IAAI,CAACyF,KAAK,CAAC;YAC5BtD,EAAE,GAAG,IAAI,CAACP,IAAI,CAACD,IAAI;YACnB,OAAO,CAAC,CAAC,CAAC,WAAWwC,MAAM,CAACqC,IAAI,CAAC,IAAI,CAACzB,YAAY,CAAC,CAAC,CAAC,CAAC;UAC1D,KAAK,CAAC;YACF5C,EAAE,CAACb,SAAS,GAAGgB,EAAE,CAACrD,IAAI,CAAC,CAAC;YACxB,OAAO,CAAC,CAAC,CAAC,YAAYwG,KAAK,CAAC;QACpC;MACJ,CAAC,CAAC;IACN,CAAC,CAAC;EACN,CAAC;EACDtF,uBAAuB,CAAC1C,SAAS,CAACgJ,SAAS,GAAG,UAAUtF,IAAI,EAAE;IAC1D,OAAO,IAAI,CAACS,IAAI,CAACJ,MAAM,CAACkF,IAAI,CAAC,CAAC,CAAC,EAAE3F,OAAO,CAACuF,QAAQ,EAAEnF,IAAI,CAAC,CAAC;EAC7D,CAAC;EACDhB,uBAAuB,CAAC1C,SAAS,CAAC4H,YAAY,GAAG,UAAUlE,IAAI,EAAE;IAC7D,OAAO,IAAI,CAACS,IAAI,CAACJ,MAAM,CAACuE,MAAM,CAAC,CAAC,CAAC,EAAEhF,OAAO,CAACuF,QAAQ,EAAEnF,IAAI,CAAC,CAAC;EAC/D,CAAC;EACD,OAAOhB,uBAAuB;AAClC,CAAC,CAAC,CAAE;AACJD,OAAO,CAACC,uBAAuB,GAAGA,uBAAuB;AACzD;AACA;AACA,SAASyD,WAAWA,CAAC7B,4BAA4B,EAAE;EAC/C,OAAOnE,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,YAAY;IAC/C,OAAOiB,WAAW,CAAC,IAAI,EAAE,UAAUsD,EAAE,EAAE;MACnC,IAAIJ,4BAA4B,YAAYjB,UAAU,CAAC6F,eAAe,EAAE;QACpE,OAAO,CAAC,CAAC,CAAC,YAAY5E,4BAA4B,CAAC;MACvD,CAAC,MACI;QACD,OAAO,CAAC,CAAC,CAAC,YAAYA,4BAA4B,CAAC6E,SAAS,CAAChD,WAAW,CAAC,CAAC,CAAC;MAC/E;MACA,OAAO,CAAC,CAAC,CAAC,WAAW;IACzB,CAAC,CAAC;EACN,CAAC,CAAC;AACN"},"metadata":{},"sourceType":"script"}