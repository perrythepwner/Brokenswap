{"ast":null,"code":"import _asyncToGenerator from \"/home/simone/Scrivania/progetti/HTB_challs/HackTheBoo_23/VeryEasy2/Brokenswap/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\n// @ts-nocheck\nimport { useConnectedSigner } from '@celo/react-celo';\nimport { MaxUint256 } from '@ethersproject/constants';\nimport { TokenAmount } from '@ubeswap/sdk';\nimport { useCallback, useMemo } from 'react';\nimport { useUserMinApprove } from 'state/user/hooks';\nimport { useTokenAllowance } from '../data/Allowances';\nimport { Field } from '../state/swap/actions';\nimport { useHasPendingApproval } from '../state/transactions/hooks';\nimport { computeSlippageAdjustedAmounts } from '../utils/prices';\nimport { useTokenContract } from './useContract';\nexport let ApprovalState = /*#__PURE__*/function (ApprovalState) {\n  ApprovalState[ApprovalState[\"UNKNOWN\"] = 0] = \"UNKNOWN\";\n  ApprovalState[ApprovalState[\"NOT_APPROVED\"] = 1] = \"NOT_APPROVED\";\n  ApprovalState[ApprovalState[\"PENDING\"] = 2] = \"PENDING\";\n  ApprovalState[ApprovalState[\"APPROVED\"] = 3] = \"APPROVED\";\n  return ApprovalState;\n}({});\n\n// returns a variable indicating the state of the approval and a function which approves if necessary or early returns\nexport function useApproveCallback(amountToApprove, spender) {\n  _s();\n  var _account;\n  const signer = useConnectedSigner();\n  const token = amountToApprove instanceof TokenAmount ? amountToApprove.token : undefined;\n  const [minApprove] = useUserMinApprove();\n  const currentAllowance = useTokenAllowance(token, (_account = account) !== null && _account !== void 0 ? _account : undefined, spender);\n  const pendingApproval = useHasPendingApproval(token === null || token === void 0 ? void 0 : token.address, spender);\n\n  // check the current approval status\n  const approvalState = useMemo(() => {\n    if (!amountToApprove || !spender) return ApprovalState.UNKNOWN;\n    // we might not have enough data to know whether or not we need to approve\n    if (!currentAllowance) return ApprovalState.UNKNOWN;\n\n    // amountToApprove will be defined if currentAllowance is\n    return currentAllowance.lessThan(amountToApprove) ? pendingApproval ? ApprovalState.PENDING : ApprovalState.NOT_APPROVED : ApprovalState.APPROVED;\n  }, [amountToApprove, currentAllowance, pendingApproval, spender]);\n  const tokenContractDisconnected = useTokenContract(token === null || token === void 0 ? void 0 : token.address);\n  const approve = useCallback( /*#__PURE__*/_asyncToGenerator(function* () {\n    if (approvalState !== ApprovalState.NOT_APPROVED) {\n      console.error('approve was called unnecessarily');\n      return;\n    }\n    if (!token) {\n      console.error('no token');\n      return;\n    }\n    if (!tokenContractDisconnected) {\n      console.error('tokenContract is null');\n      return;\n    }\n    if (!amountToApprove) {\n      console.error('missing amount to approve');\n      return;\n    }\n    if (!spender) {\n      console.error('no spender');\n      return;\n    }\n\n    // connect\n    const tokenContract = tokenContractDisconnected.connect(signer);\n    if (minApprove) {\n      yield doTransaction(tokenContract, 'approve', {\n        args: [spender, amountToApprove.raw.toString()],\n        summary: \"Approve \".concat(amountToApprove.toSignificant(6), \" \").concat(amountToApprove.currency.symbol),\n        approval: {\n          tokenAddress: token.address,\n          spender: spender\n        }\n      });\n    } else {\n      yield doTransaction(tokenContract, 'approve', {\n        args: [spender, MaxUint256],\n        summary: \"Approve \".concat(amountToApprove.currency.symbol),\n        approval: {\n          tokenAddress: token.address,\n          spender: spender\n        }\n      });\n    }\n  }), [approvalState, token, tokenContractDisconnected, amountToApprove, spender, signer, minApprove, doTransaction]);\n  return [approvalState, approve];\n}\n\n// wraps useApproveCallback in the context of a swap\n_s(useApproveCallback, \"zBaEUZEbRbPGXtBI1cUpeG/IbAs=\", false, function () {\n  return [useConnectedSigner, useUserMinApprove, useTokenAllowance, useHasPendingApproval, useTokenContract];\n});\nexport function useApproveCallbackFromTrade(trade) {\n  _s2();\n  let allowedSlippage = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  const amountToApprove = useMemo(() => trade ? computeSlippageAdjustedAmounts(trade, allowedSlippage)[Field.INPUT] : undefined, [trade, allowedSlippage]);\n  return useApproveCallback();\n}\n_s2(useApproveCallbackFromTrade, \"GmUgVOF70hjek2iOjUgFAqTvTUk=\", false, function () {\n  return [useApproveCallback];\n});","map":{"version":3,"names":["useConnectedSigner","MaxUint256","TokenAmount","useCallback","useMemo","useUserMinApprove","useTokenAllowance","Field","useHasPendingApproval","computeSlippageAdjustedAmounts","useTokenContract","ApprovalState","useApproveCallback","amountToApprove","spender","_s","_account","signer","token","undefined","minApprove","currentAllowance","account","pendingApproval","address","approvalState","UNKNOWN","lessThan","PENDING","NOT_APPROVED","APPROVED","tokenContractDisconnected","approve","_asyncToGenerator","console","error","tokenContract","connect","doTransaction","args","raw","toString","summary","concat","toSignificant","currency","symbol","approval","tokenAddress","useApproveCallbackFromTrade","trade","_s2","allowedSlippage","arguments","length","INPUT"],"sources":["/home/simone/Scrivania/progetti/HTB_challs/HackTheBoo_23/VeryEasy2/Brokenswap/frontend/src/hooks/useApproveCallback.ts"],"sourcesContent":["// @ts-nocheck\nimport { useCelo, useConnectedSigner } from '@celo/react-celo'\nimport { MaxUint256 } from '@ethersproject/constants'\nimport { JsonRpcSigner } from '@ethersproject/providers'\nimport { TokenAmount, Trade } from '@ubeswap/sdk'\nimport { useCallback, useMemo } from 'react'\nimport { useUserMinApprove } from 'state/user/hooks'\nimport { useTokenAllowance } from '../data/Allowances'\nimport { Field } from '../state/swap/actions'\nimport { useHasPendingApproval } from '../state/transactions/hooks'\nimport { computeSlippageAdjustedAmounts } from '../utils/prices'\nimport { useTokenContract } from './useContract'\n\nexport enum ApprovalState {\n  UNKNOWN,\n  NOT_APPROVED,\n  PENDING,\n  APPROVED,\n}\n\n// returns a variable indicating the state of the approval and a function which approves if necessary or early returns\nexport function useApproveCallback(\n  amountToApprove?: TokenAmount,\n  spender?: string\n): [ApprovalState, () => Promise<void>] {\n  \n  const signer = useConnectedSigner() as JsonRpcSigner\n\n  const token = amountToApprove instanceof TokenAmount ? amountToApprove.token : undefined\n  const [minApprove] = useUserMinApprove()\n  const currentAllowance = useTokenAllowance(token, account ?? undefined, spender)\n  const pendingApproval = useHasPendingApproval(token?.address, spender)\n\n  // check the current approval status\n  const approvalState: ApprovalState = useMemo(() => {\n    if (!amountToApprove || !spender) return ApprovalState.UNKNOWN\n    // we might not have enough data to know whether or not we need to approve\n    if (!currentAllowance) return ApprovalState.UNKNOWN\n\n    // amountToApprove will be defined if currentAllowance is\n    return currentAllowance.lessThan(amountToApprove)\n      ? pendingApproval\n        ? ApprovalState.PENDING\n        : ApprovalState.NOT_APPROVED\n      : ApprovalState.APPROVED\n  }, [amountToApprove, currentAllowance, pendingApproval, spender])\n\n  const tokenContractDisconnected = useTokenContract(token?.address)\n\n  const approve = useCallback(async (): Promise<void> => {\n    if (approvalState !== ApprovalState.NOT_APPROVED) {\n      console.error('approve was called unnecessarily')\n      return\n    }\n    if (!token) {\n      console.error('no token')\n      return\n    }\n\n    if (!tokenContractDisconnected) {\n      console.error('tokenContract is null')\n      return\n    }\n\n    if (!amountToApprove) {\n      console.error('missing amount to approve')\n      return\n    }\n\n    if (!spender) {\n      console.error('no spender')\n      return\n    }\n\n    // connect\n    const tokenContract = tokenContractDisconnected.connect(signer)\n\n    if (minApprove) {\n      await doTransaction(tokenContract, 'approve', {\n        args: [spender, amountToApprove.raw.toString()],\n        summary: `Approve ${amountToApprove.toSignificant(6)} ${amountToApprove.currency.symbol}`,\n        approval: { tokenAddress: token.address, spender: spender },\n      })\n    } else {\n      await doTransaction(tokenContract, 'approve', {\n        args: [spender, MaxUint256],\n        summary: `Approve ${amountToApprove.currency.symbol}`,\n        approval: { tokenAddress: token.address, spender: spender },\n      })\n    }\n  }, [approvalState, token, tokenContractDisconnected, amountToApprove, spender, signer, minApprove, doTransaction])\n\n  return [approvalState, approve]\n}\n\n// wraps useApproveCallback in the context of a swap\nexport function useApproveCallbackFromTrade(trade?: Trade, allowedSlippage = 0) {\n  const amountToApprove = useMemo(\n    () => (trade ? computeSlippageAdjustedAmounts(trade, allowedSlippage)[Field.INPUT] : undefined),\n    [trade, allowedSlippage]\n  )\n  return useApproveCallback()\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}