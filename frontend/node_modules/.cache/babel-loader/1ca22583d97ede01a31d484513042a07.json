{"ast":null,"code":"import _asyncToGenerator from\"/home/simone/Scrivania/progetti/HTB_challs/HackTheBoo_23/VeryEasy2/Brokenswap/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{CeloContract}from'@celo/contractkit';import{currencyEquals}from'@ubeswap/sdk';import{LendingPool__factory}from'../../../../generated';import{moolaLendingPools}from'./useMoola';/**\n * Executes a trade on Moola.\n * @param trade\n * @returns\n */export const executeMoolaDirectTrade=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(function*(_ref){let{trade,signer,chainId,doTransaction}=_ref;const chainCfg=moolaLendingPools[chainId];const{mcUSD,mCELO}=chainCfg;const pool=LendingPool__factory.connect(chainCfg.lendingPool,signer);const{inputAmount,outputAmount}=trade;const token=inputAmount.token;const convert=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(function*(){var _token$symbol;const symbol=currencyEquals(token,chainCfg[CeloContract.StableToken])?'cUSD':currencyEquals(token,chainCfg[CeloContract.GoldToken])?'CELO':currencyEquals(token,mcUSD)?'mcUSD':currencyEquals(token,mCELO)?'mCELO':(_token$symbol=token.symbol)!==null&&_token$symbol!==void 0?_token$symbol:null;if(symbol!==null&&symbol!==void 0&&symbol.startsWith('m')){const recipient=yield signer.getAddress();return yield doTransaction(pool,'withdraw',{args:[outputAmount.token.address,outputAmount.raw.toString(),recipient],summary:\"Withdraw \".concat(inputAmount.toSignificant(2),\" \").concat(symbol,\" from Moola\")});}if(symbol){const recipient=yield signer.getAddress();return yield doTransaction(pool,'deposit',{args:[inputAmount.token.address,inputAmount.raw.toString(),recipient,0x0421],summary:\"Deposit \".concat(inputAmount.toSignificant(2),\" \").concat(symbol,\" into Moola\")});}throw new Error(\"unknown currency: \".concat(token.address));});return function convert(){return _ref3.apply(this,arguments);};}();return{hash:(yield convert()).hash};});return function executeMoolaDirectTrade(_x){return _ref2.apply(this,arguments);};}();","map":{"version":3,"names":["CeloContract","currencyEquals","LendingPool__factory","moolaLendingPools","executeMoolaDirectTrade","_ref2","_asyncToGenerator","_ref","trade","signer","chainId","doTransaction","chainCfg","mcUSD","mCELO","pool","connect","lendingPool","inputAmount","outputAmount","token","convert","_ref3","_token$symbol","symbol","StableToken","GoldToken","startsWith","recipient","getAddress","args","address","raw","toString","summary","concat","toSignificant","Error","apply","arguments","hash","_x"],"sources":["/home/simone/Scrivania/progetti/HTB_challs/HackTheBoo_23/VeryEasy2/Brokenswap/frontend/src/components/swap/routing/moola/executeMoolaDirectTrade.ts"],"sourcesContent":["import { CeloContract } from '@celo/contractkit'\nimport { currencyEquals } from '@ubeswap/sdk'\nimport { ContractTransaction } from 'ethers'\n\nimport { LendingPool__factory } from '../../../../generated'\nimport { TradeExecutor } from '..'\nimport { MoolaDirectTrade } from './MoolaDirectTrade'\nimport { moolaLendingPools } from './useMoola'\n\n/**\n * Executes a trade on Moola.\n * @param trade\n * @returns\n */\nexport const executeMoolaDirectTrade: TradeExecutor<MoolaDirectTrade> = async ({\n  trade,\n  signer,\n  chainId,\n  doTransaction,\n}) => {\n  const chainCfg = moolaLendingPools[chainId]\n  const { mcUSD, mCELO } = chainCfg\n\n  const pool = LendingPool__factory.connect(chainCfg.lendingPool, signer)\n\n  const { inputAmount, outputAmount } = trade\n  const token = inputAmount.token\n\n  const convert = async (): Promise<ContractTransaction> => {\n    const symbol = currencyEquals(token, chainCfg[CeloContract.StableToken])\n      ? 'cUSD'\n      : currencyEquals(token, chainCfg[CeloContract.GoldToken])\n      ? 'CELO'\n      : currencyEquals(token, mcUSD)\n      ? 'mcUSD'\n      : currencyEquals(token, mCELO)\n      ? 'mCELO'\n      : token.symbol ?? null\n\n    if (symbol?.startsWith('m')) {\n      const recipient = await signer.getAddress()\n      return await doTransaction(pool, 'withdraw', {\n        args: [outputAmount.token.address, outputAmount.raw.toString(), recipient],\n        summary: `Withdraw ${inputAmount.toSignificant(2)} ${symbol} from Moola`,\n      })\n    }\n    if (symbol) {\n      const recipient = await signer.getAddress()\n      return await doTransaction(pool, 'deposit', {\n        args: [inputAmount.token.address, inputAmount.raw.toString(), recipient, 0x0421],\n        summary: `Deposit ${inputAmount.toSignificant(2)} ${symbol} into Moola`,\n      })\n    }\n    throw new Error(`unknown currency: ${token.address}`)\n  }\n\n  return { hash: (await convert()).hash }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}