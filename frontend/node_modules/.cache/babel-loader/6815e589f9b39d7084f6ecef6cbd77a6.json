{"ast":null,"code":"var _asyncToGenerator = require(\"/home/simone/Scrivania/progetti/HTB_challs/HackTheBoo_23/VeryEasy2/Brokenswap/frontend/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\nconst EthQuery = require('eth-query');\nconst pify = require('pify');\nconst BaseFilterWithHistory = require('./base-filter-history');\nconst {\n  bnToHex,\n  hexToInt,\n  incrementHexInt,\n  minBlockRef,\n  blockRefIsNumber\n} = require('./hexUtils');\nclass LogFilter extends BaseFilterWithHistory {\n  constructor(_ref) {\n    let {\n      provider,\n      params\n    } = _ref;\n    super();\n    this.type = 'log';\n    this.ethQuery = new EthQuery(provider);\n    this.params = Object.assign({\n      fromBlock: 'latest',\n      toBlock: 'latest',\n      address: undefined,\n      topics: []\n    }, params);\n    // normalize address parameter\n    if (this.params.address) {\n      // ensure array\n      if (!Array.isArray(this.params.address)) {\n        this.params.address = [this.params.address];\n      }\n      // ensure lowercase\n      this.params.address = this.params.address.map(address => address.toLowerCase());\n    }\n  }\n  initialize(_ref2) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      let {\n        currentBlock\n      } = _ref2;\n      // resolve params.fromBlock\n      let fromBlock = _this.params.fromBlock;\n      if (['latest', 'pending'].includes(fromBlock)) fromBlock = currentBlock;\n      if ('earliest' === fromBlock) fromBlock = '0x0';\n      _this.params.fromBlock = fromBlock;\n      // set toBlock for initial lookup\n      const toBlock = minBlockRef(_this.params.toBlock, currentBlock);\n      const params = Object.assign({}, _this.params, {\n        toBlock\n      });\n      // fetch logs and add to results\n      const newLogs = yield _this._fetchLogs(params);\n      _this.addInitialResults(newLogs);\n    })();\n  }\n  update(_ref3) {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      let {\n        oldBlock,\n        newBlock\n      } = _ref3;\n      // configure params for this update\n      const toBlock = newBlock;\n      let fromBlock;\n      // oldBlock is empty on first sync\n      if (oldBlock) {\n        fromBlock = incrementHexInt(oldBlock);\n      } else {\n        fromBlock = newBlock;\n      }\n      // fetch logs\n      const params = Object.assign({}, _this2.params, {\n        fromBlock,\n        toBlock\n      });\n      const newLogs = yield _this2._fetchLogs(params);\n      const matchingLogs = newLogs.filter(log => _this2.matchLog(log));\n\n      // add to results\n      _this2.addResults(matchingLogs);\n    })();\n  }\n  _fetchLogs(params) {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      const newLogs = yield pify(cb => _this3.ethQuery.getLogs(params, cb))();\n      // add to results\n      return newLogs;\n    })();\n  }\n  matchLog(log) {\n    // check if block number in bounds:\n    if (hexToInt(this.params.fromBlock) >= hexToInt(log.blockNumber)) return false;\n    if (blockRefIsNumber(this.params.toBlock) && hexToInt(this.params.toBlock) <= hexToInt(log.blockNumber)) return false;\n\n    // address is correct:\n    const normalizedLogAddress = log.address && log.address.toLowerCase();\n    if (this.params.address && normalizedLogAddress && !this.params.address.includes(normalizedLogAddress)) return false;\n\n    // topics match:\n    // topics are position-dependant\n    // topics can be nested to represent `or` [[a || b], c]\n    // topics can be null, representing a wild card for that position\n    const topicsMatch = this.params.topics.every((topicPattern, index) => {\n      // pattern is longer than actual topics\n      let logTopic = log.topics[index];\n      if (!logTopic) return false;\n      logTopic = logTopic.toLowerCase();\n      // normalize subTopics\n      let subtopicsToMatch = Array.isArray(topicPattern) ? topicPattern : [topicPattern];\n      // check for wild card\n      const subtopicsIncludeWildcard = subtopicsToMatch.includes(null);\n      if (subtopicsIncludeWildcard) return true;\n      subtopicsToMatch = subtopicsToMatch.map(topic => topic.toLowerCase());\n      // check each possible matching topic\n      const topicDoesMatch = subtopicsToMatch.includes(logTopic);\n      return topicDoesMatch;\n    });\n    return topicsMatch;\n  }\n}\nmodule.exports = LogFilter;","map":{"version":3,"names":["EthQuery","require","pify","BaseFilterWithHistory","bnToHex","hexToInt","incrementHexInt","minBlockRef","blockRefIsNumber","LogFilter","constructor","_ref","provider","params","type","ethQuery","Object","assign","fromBlock","toBlock","address","undefined","topics","Array","isArray","map","toLowerCase","initialize","_ref2","_this","_asyncToGenerator","currentBlock","includes","newLogs","_fetchLogs","addInitialResults","update","_ref3","_this2","oldBlock","newBlock","matchingLogs","filter","log","matchLog","addResults","_this3","cb","getLogs","blockNumber","normalizedLogAddress","topicsMatch","every","topicPattern","index","logTopic","subtopicsToMatch","subtopicsIncludeWildcard","topic","topicDoesMatch","module","exports"],"sources":["/home/simone/Scrivania/progetti/HTB_challs/HackTheBoo_23/VeryEasy2/Brokenswap/frontend/node_modules/eth-json-rpc-filters/log-filter.js"],"sourcesContent":["const EthQuery = require('eth-query')\nconst pify = require('pify')\nconst BaseFilterWithHistory = require('./base-filter-history')\nconst { bnToHex, hexToInt, incrementHexInt, minBlockRef, blockRefIsNumber } = require('./hexUtils')\n\nclass LogFilter extends BaseFilterWithHistory {\n\n  constructor ({ provider, params }) {\n    super()\n    this.type = 'log'\n    this.ethQuery = new EthQuery(provider)\n    this.params = Object.assign({\n      fromBlock: 'latest',\n      toBlock: 'latest',\n      address: undefined,\n      topics: [],\n    }, params)\n    // normalize address parameter\n    if (this.params.address) {\n      // ensure array\n      if (!Array.isArray(this.params.address)) {\n        this.params.address = [this.params.address]\n      }\n      // ensure lowercase\n      this.params.address = this.params.address.map(address => address.toLowerCase())\n    }\n  }\n\n  async initialize({ currentBlock }) {\n    // resolve params.fromBlock\n    let fromBlock = this.params.fromBlock\n    if (['latest', 'pending'].includes(fromBlock)) fromBlock = currentBlock\n    if ('earliest' === fromBlock) fromBlock = '0x0'\n    this.params.fromBlock = fromBlock\n    // set toBlock for initial lookup\n    const toBlock = minBlockRef(this.params.toBlock, currentBlock)\n    const params = Object.assign({}, this.params, { toBlock })\n    // fetch logs and add to results\n    const newLogs = await this._fetchLogs(params)\n    this.addInitialResults(newLogs)\n  }\n\n  async update ({ oldBlock, newBlock }) {\n    // configure params for this update\n    const toBlock = newBlock\n    let fromBlock\n    // oldBlock is empty on first sync\n    if (oldBlock) {\n      fromBlock = incrementHexInt(oldBlock)\n    } else {\n      fromBlock = newBlock\n    }\n    // fetch logs\n    const params = Object.assign({}, this.params, { fromBlock, toBlock })\n    const newLogs = await this._fetchLogs(params)\n    const matchingLogs = newLogs.filter(log => this.matchLog(log))\n\n    // add to results\n    this.addResults(matchingLogs)\n  }\n\n  async _fetchLogs (params) {\n    const newLogs = await pify(cb => this.ethQuery.getLogs(params, cb))()\n    // add to results\n    return newLogs\n  }\n\n  matchLog(log) {\n    // check if block number in bounds:\n    if (hexToInt(this.params.fromBlock) >= hexToInt(log.blockNumber)) return false\n    if (blockRefIsNumber(this.params.toBlock) && hexToInt(this.params.toBlock) <= hexToInt(log.blockNumber)) return false\n\n    // address is correct:\n    const normalizedLogAddress = log.address && log.address.toLowerCase()\n    if (this.params.address && normalizedLogAddress && !this.params.address.includes(normalizedLogAddress)) return false\n\n    // topics match:\n    // topics are position-dependant\n    // topics can be nested to represent `or` [[a || b], c]\n    // topics can be null, representing a wild card for that position\n    const topicsMatch = this.params.topics.every((topicPattern, index) => {\n      // pattern is longer than actual topics\n      let logTopic = log.topics[index]\n      if (!logTopic) return false\n      logTopic = logTopic.toLowerCase()\n      // normalize subTopics\n      let subtopicsToMatch = Array.isArray(topicPattern) ? topicPattern : [topicPattern]\n      // check for wild card\n      const subtopicsIncludeWildcard = subtopicsToMatch.includes(null)\n      if (subtopicsIncludeWildcard) return true\n      subtopicsToMatch = subtopicsToMatch.map(topic => topic.toLowerCase())\n      // check each possible matching topic\n      const topicDoesMatch = subtopicsToMatch.includes(logTopic)\n      return topicDoesMatch\n    })\n\n    return topicsMatch\n  }\n\n}\n\nmodule.exports = LogFilter\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}