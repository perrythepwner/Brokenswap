{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar color_1 = require(\"../color\");\nvar vbox_1 = __importDefault(require(\"./vbox\"));\nvar pqueue_1 = __importDefault(require(\"./pqueue\"));\nvar fractByPopulations = 0.75;\nfunction _splitBoxes(pq, target) {\n  var lastSize = pq.size();\n  while (pq.size() < target) {\n    var vbox = pq.pop();\n    if (vbox && vbox.count() > 0) {\n      var _a = vbox.split(),\n        vbox1 = _a[0],\n        vbox2 = _a[1];\n      pq.push(vbox1);\n      if (vbox2 && vbox2.count() > 0) pq.push(vbox2);\n      // No more new boxes, converged\n      if (pq.size() === lastSize) {\n        break;\n      } else {\n        lastSize = pq.size();\n      }\n    } else {\n      break;\n    }\n  }\n}\nvar MMCQ = function MMCQ(pixels, opts) {\n  if (pixels.length === 0 || opts.colorCount < 2 || opts.colorCount > 256) {\n    throw new Error('Wrong MMCQ parameters');\n  }\n  var vbox = vbox_1.default.build(pixels);\n  var hist = vbox.hist;\n  var colorCount = Object.keys(hist).length;\n  var pq = new pqueue_1.default(function (a, b) {\n    return a.count() - b.count();\n  });\n  pq.push(vbox);\n  // first set of colors, sorted by population\n  _splitBoxes(pq, fractByPopulations * opts.colorCount);\n  // Re-order\n  var pq2 = new pqueue_1.default(function (a, b) {\n    return a.count() * a.volume() - b.count() * b.volume();\n  });\n  pq2.contents = pq.contents;\n  // next set - generate the median cuts using the (npix * vol) sorting.\n  _splitBoxes(pq2, opts.colorCount - pq2.size());\n  // calculate the actual colors\n  return generateSwatches(pq2);\n};\nfunction generateSwatches(pq) {\n  var swatches = [];\n  while (pq.size()) {\n    var v = pq.pop();\n    var color = v.avg();\n    var r = color[0],\n      g = color[1],\n      b = color[2];\n    swatches.push(new color_1.Swatch(color, v.count()));\n  }\n  return swatches;\n}\nexports.default = MMCQ;","map":null,"metadata":{},"sourceType":"script"}